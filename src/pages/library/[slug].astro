---
import { getCollection } from 'astro:content';
import Layout from '../../components/Layout.astro';

export const prerender = false;

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const allEntries = await getCollection('library');
const entry = allEntries.find(e => e.id === slug);

if (!entry) {
  console.log(`[library] No entry found for slug: ${slug}`);
  return Astro.redirect('/404');
}

let Content;
try {
  const rendered = await (entry as any).render();
  Content = rendered.Content;
} catch (err) {
  console.error(`[library] Error rendering ${slug}:`, err);
  return new Response(`Render error: ${err instanceof Error ? err.message : String(err)}`, { status: 500 });
}
---

<Layout pageTitle={entry.data.title} pageStyle="library">
  <Content />
</Layout>
