---
import { getCollection } from 'astro:content';
import Layout from '../../components/Layout.astro';

export const prerender = false;

const { slug } = Astro.params;

// Debug: Always log that we're here
console.log(`[earth] PAGE CALLED with slug: ${slug}`);
console.log(`[earth] Astro.url:`, Astro.url.pathname);

if (!slug) {
  console.log(`[earth] No slug in params`);
  return new Response('No slug provided', { status: 404 });
}

const allEntries = await getCollection('earth');
console.log(`[earth] Total entries loaded: ${allEntries.length}`);
console.log(`[earth] First 5 IDs:`, allEntries.slice(0, 5).map(e => e.id));

const entry = allEntries.find(e => e.id === slug);

if (!entry) {
  console.log(`[earth] No entry found for slug: ${slug}`);
  return new Response(`Entry not found: ${slug}. Available: ${allEntries.slice(0, 5).map(e => e.id).join(', ')}`, { status: 404 });
}

console.log(`[earth] Found entry: ${entry.id}`);

let Content;
try {
  const rendered = await (entry as any).render();
  Content = rendered.Content;
} catch (err) {
  console.error(`[earth] Error rendering ${slug}:`, err);
  return new Response(`Render error: ${err instanceof Error ? err.message : String(err)}`, { status: 500 });
}
---

<Layout pageTitle={entry.data.title} pageStyle="earth">
  <Content />
</Layout>
